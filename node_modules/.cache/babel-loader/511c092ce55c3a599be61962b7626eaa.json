{"ast":null,"code":"'use strict';\n\nvar sequences = {};\nvar DEFAULTS = {\n  timestamp: function timestamp() {\n    return Date.now();\n  },\n  datetime: function datetime() {\n    return new Date().toISOString();\n  },\n  date: function date() {\n    return new Date().toISOString().slice(0, 10);\n  },\n  time: function time() {\n    return new Date().toISOString().slice(11);\n  },\n  random: function random() {\n    return Math.random();\n  },\n  randomint: function randomint(args) {\n    var limit = args && args.max || 2;\n    return function () {\n      return Math.floor(Math.random() * limit);\n    };\n  },\n  seq: function seq(args) {\n    var name = args && args.name || '';\n    sequences[name] = sequences[name] || 0;\n    return function () {\n      return sequences[name]++;\n    };\n  }\n};\n\nmodule.exports = function defFunc(ajv) {\n  defFunc.definition = {\n    compile: function compile(schema, parentSchema, it) {\n      var funcs = {};\n\n      for (var key in schema) {\n        var d = schema[key];\n        var func = getDefault(typeof d == 'string' ? d : d.func);\n        funcs[key] = func.length ? func(d.args) : func;\n      }\n\n      return it.opts.useDefaults && !it.compositeRule ? assignDefaults : noop;\n\n      function assignDefaults(data) {\n        for (var prop in schema) {\n          if (data[prop] === undefined || it.opts.useDefaults == 'empty' && (data[prop] === null || data[prop] === '')) data[prop] = funcs[prop]();\n        }\n\n        return true;\n      }\n\n      function noop() {\n        return true;\n      }\n    },\n    DEFAULTS: DEFAULTS,\n    metaSchema: {\n      type: 'object',\n      additionalProperties: {\n        type: ['string', 'object'],\n        additionalProperties: false,\n        required: ['func', 'args'],\n        properties: {\n          func: {\n            type: 'string'\n          },\n          args: {\n            type: 'object'\n          }\n        }\n      }\n    }\n  };\n  ajv.addKeyword('dynamicDefaults', defFunc.definition);\n  return ajv;\n\n  function getDefault(d) {\n    var def = DEFAULTS[d];\n    if (def) return def;\n    throw new Error('invalid \"dynamicDefaults\" keyword property value: ' + d);\n  }\n};","map":null,"metadata":{},"sourceType":"module"}