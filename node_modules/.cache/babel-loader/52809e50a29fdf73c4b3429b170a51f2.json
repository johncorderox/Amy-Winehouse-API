{"ast":null,"code":"'use strict';\n\nmodule.exports = inflight;\nvar Bluebird;\n\ntry {\n  Bluebird = require('bluebird');\n} catch (_) {\n  Bluebird = Promise;\n}\n\nvar active = {};\ninflight.active = active;\n\nfunction inflight(unique, doFly) {\n  return Bluebird.all([unique, doFly]).then(function (args) {\n    var unique = args[0];\n    var doFly = args[1];\n\n    if (Array.isArray(unique)) {\n      return Bluebird.all(unique).then(function (uniqueArr) {\n        return _inflight(uniqueArr.join(''), doFly);\n      });\n    } else {\n      return _inflight(unique, doFly);\n    }\n  });\n\n  function _inflight(unique, doFly) {\n    if (!active[unique]) {\n      var cleanup = function cleanup() {\n        delete active[unique];\n      };\n\n      active[unique] = new Bluebird(function (resolve) {\n        return resolve(doFly());\n      });\n      active[unique].then(cleanup, cleanup);\n    }\n\n    return active[unique];\n  }\n}","map":null,"metadata":{},"sourceType":"module"}