{"ast":null,"code":"/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n\"use strict\";\n\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nvar ExternalModule = require(\"./ExternalModule\");\n\nvar ExternalModuleFactoryPlugin = /*#__PURE__*/function () {\n  function ExternalModuleFactoryPlugin(type, externals) {\n    _classCallCheck(this, ExternalModuleFactoryPlugin);\n\n    this.type = type;\n    this.externals = externals;\n  }\n\n  _createClass(ExternalModuleFactoryPlugin, [{\n    key: \"apply\",\n    value: function apply(normalModuleFactory) {\n      var _this = this;\n\n      var globalType = this.type;\n      normalModuleFactory.hooks.factory.tap(\"ExternalModuleFactoryPlugin\", function (factory) {\n        return function (data, callback) {\n          var context = data.context;\n          var dependency = data.dependencies[0];\n\n          var handleExternal = function handleExternal(value, type, callback) {\n            if (typeof type === \"function\") {\n              callback = type;\n              type = undefined;\n            }\n\n            if (value === false) return factory(data, callback);\n            if (value === true) value = dependency.request;\n\n            if (type === undefined && /^[a-z0-9]+ /.test(value)) {\n              var idx = value.indexOf(\" \");\n              type = value.substr(0, idx);\n              value = value.substr(idx + 1);\n            }\n\n            callback(null, new ExternalModule(value, type || globalType, dependency.request));\n            return true;\n          };\n\n          var handleExternals = function handleExternals(externals, callback) {\n            if (typeof externals === \"string\") {\n              if (externals === dependency.request) {\n                return handleExternal(dependency.request, callback);\n              }\n            } else if (Array.isArray(externals)) {\n              var i = 0;\n\n              var next = function next() {\n                var asyncFlag;\n\n                var handleExternalsAndCallback = function handleExternalsAndCallback(err, module) {\n                  if (err) return callback(err);\n\n                  if (!module) {\n                    if (asyncFlag) {\n                      asyncFlag = false;\n                      return;\n                    }\n\n                    return next();\n                  }\n\n                  callback(null, module);\n                };\n\n                do {\n                  asyncFlag = true;\n                  if (i >= externals.length) return callback();\n                  handleExternals(externals[i++], handleExternalsAndCallback);\n                } while (!asyncFlag);\n\n                asyncFlag = false;\n              };\n\n              next();\n              return;\n            } else if (externals instanceof RegExp) {\n              if (externals.test(dependency.request)) {\n                return handleExternal(dependency.request, callback);\n              }\n            } else if (typeof externals === \"function\") {\n              externals.call(null, context, dependency.request, function (err, value, type) {\n                if (err) return callback(err);\n\n                if (value !== undefined) {\n                  handleExternal(value, type, callback);\n                } else {\n                  callback();\n                }\n              });\n              return;\n            } else if (_typeof(externals) === \"object\" && Object.prototype.hasOwnProperty.call(externals, dependency.request)) {\n              return handleExternal(externals[dependency.request], callback);\n            }\n\n            callback();\n          };\n\n          handleExternals(_this.externals, function (err, module) {\n            if (err) return callback(err);\n            if (!module) return handleExternal(false, callback);\n            return callback(null, module);\n          });\n        };\n      });\n    }\n  }]);\n\n  return ExternalModuleFactoryPlugin;\n}();\n\nmodule.exports = ExternalModuleFactoryPlugin;","map":null,"metadata":{},"sourceType":"module"}